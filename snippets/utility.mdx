'use client';

import { useCallback, useEffect, useRef, useState } from 'react';

export const Container = ({ children }) => {
  return (
    <div className="px-1">
      {children}
    </div>
  )
}

export const Title = ({ children }) => {
  return (
    <div className="text-neutral-900 dark:text-neutral-100 text-2xl tracking-tight">
      {children}
    </div>
  )
}

export const LearnTitle = ({ children }) => {
  return (
    <div className="text-neutral-900 dark:text-neutral-100 text-2xl font-semibold">
      {children}
    </div>
  )
}

export const TitleLink = ({ children, href }) => {
  return (
    <a
      href={href}
      className="text-neutral-900 dark:text-neutral-100 font-semibold flex items-center gap-1 hover:opacity-70 transition-opacity"
    >
      {children} <Icon icon="arrow-right" size="14" />
    </a>
  )
}

export const VideoLink = ({ children, href }) => {
  return (
    <a
      href={href}
      className="text-neutral-900 dark:text-neutral-100 font-semibold flex items-center gap-1 hover:opacity-70 transition-opacity"
    >
      {children} <Icon icon="arrow-up-right" size="14" />
    </a>
  )
}

export const QuickstartItem = ({ title, description, icon, href }) => {
  return (
    <a className="group flex items-start gap-4 hover:bg-neutral-100 dark:hover:bg-neutral-800 p-3 rounded-xl transition-colors" href={href}>
      <div className="flex-shrink-0 w-12 h-12 flex items-center justify-center rounded-lg border border-black/[0.08] dark:border-neutral-100/[0.08] bg-neutral-50 dark:bg-neutral-800">
        {icon}
      </div>
      <div>
        <div className="font-semibold text-sm text-neutral-900 dark:text-neutral-100">{title}</div>
        <div className="mt-1 text-neutral-600 dark:text-neutral-400 text-sm">{description}</div>
      </div>
    </a>
  )
}

export const ImageCard = ({ img, href, title, description }) => {
  return (
    <a href={href} target="_blank" rel="noopener noreferrer" className="group">
      <div className="flex flex-col gap-4 rounded-xl">
        <div className="w-full h-full overflow-hidden rounded-xl">
          <img
            src={img}
            className="w-full h-full object-cover transition-all duration-300 group-hover:scale-[1.02] group-hover:shadow-lg"
            alt={title}
          />
        </div>
        <div className="flex flex-col gap-3">
          <h2 className="text-xl font-semibold text-neutral-900 dark:text-neutral-100 group-hover:opacity-70 transition-opacity">
            {title}
          </h2>
          <p className="text-neutral-600 dark:text-neutral-400 font-medium text-lg">
            {description}
          </p>
        </div>
      </div>
    </a>
  );
};

export const WaitlistButton = ({ href = '#', label = 'Join waitlist' }) => {
  return (
    <a
      href={href}
      className="
              inline-flex items-center gap-2
        px-4 py-2 rounded-md text-sm font-medium
        border
        border-neutral-900 text-neutral-100 bg-neutral-900 
        hover:bg-neutral-800 hover:text-neutral-100
        transition-colors
        no-underline
        dark:border-neutral-700 dark:text-neutral-900 dark:bg-neutral-800 
        dark:hover:bg-neutral-700 dark:hover:text-neutral-100
      "
      style={{ maxHeight: 40 }}
    >
      {label}
    </a>
  );
};

export const CaseStudy = ({
  title,
  subtitle,
  icon,
  image,
  imageAlt = '',
  quotes = [],
  summary,
  steps = [],
  layout = 'split',
}) => {
  const [activeQuoteIndex, setActiveQuoteIndex] = useState(0);
  const [typedQuote, setTypedQuote] = useState('');
  const [isDeleting, setIsDeleting] = useState(false);
  const hasMultipleQuotes = quotes.length > 1;
  const typingTimeoutRef = useRef(null);
  const holdTimeoutRef = useRef(null);
  const charIndexRef = useRef(0);
  const targetRef = useRef('');
  const typingSpeed = 25;
  const deletingSpeed = 15;
  const holdDuration = 1800;
  const pauseAfterDelete = 300;

  const clearTimers = () => {
    if (typingTimeoutRef.current) {
      clearTimeout(typingTimeoutRef.current);
      typingTimeoutRef.current = null;
    }
    if (holdTimeoutRef.current) {
      clearTimeout(holdTimeoutRef.current);
      holdTimeoutRef.current = null;
    }
  };

  useEffect(() => {
    if (!quotes.length) return undefined;

    clearTimers();
    setIsDeleting(false);
    setTypedQuote('');
    charIndexRef.current = 0;
    const currentQuote = quotes[activeQuoteIndex] ?? '';
    targetRef.current = `"${currentQuote}"`;

    const typeNext = () => {
      if (charIndexRef.current < targetRef.current.length) {
        setTypedQuote((prev) => {
          const nextChar = targetRef.current.charAt(charIndexRef.current);
          charIndexRef.current += 1;
          return prev + nextChar;
        });
        typingTimeoutRef.current = setTimeout(typeNext, typingSpeed);
      } else if (hasMultipleQuotes) {
        holdTimeoutRef.current = setTimeout(() => {
          setIsDeleting(true);
          deleteQuote();
        }, holdDuration);
      }
    };

    const deleteQuote = () => {
      setTypedQuote((prev) => {
        if (prev.length > 0) {
          typingTimeoutRef.current = setTimeout(deleteQuote, deletingSpeed);
          return prev.slice(0, -1);
        } else {
          setIsDeleting(false);
          holdTimeoutRef.current = setTimeout(() => {
            setActiveQuoteIndex((prevIdx) => (prevIdx + 1) % quotes.length);
          }, pauseAfterDelete);
          return '';
        }
      });
    };

    typeNext();

    return () => {
      clearTimers();
    };
  }, [activeQuoteIndex, quotes, hasMultipleQuotes, typingSpeed, deletingSpeed, holdDuration, pauseAfterDelete]);

  const StepsList = () => {
    if (!steps.length) return null;
    return (
      <div className="space-y-2">
        <br/>
        <p className="text-m font-medium text-neutral-900 dark:text-neutral-100 mt-4">Rover solves this:</p>
        <ol className="list-decimal space-y-2 pl-5 text-m leading-6 text-neutral-700 dark:text-neutral-300">
          {steps.map((step, index) => (
            <li key={`${step}-${index}`}>{step}</li>
          ))}
        </ol>
      </div>
    );
  };

  if (layout === 'full') {
    return (
      <section className="flex flex-col gap-6 py-8">
        <div>
          <h3 className="text-lg font-semibold text-neutral-900 dark:text-neutral-100">{title}</h3>
          {subtitle ? <p className="text-sm text-neutral-600 dark:text-neutral-400">{subtitle}</p> : null}
        </div>

        {quotes.length ? (
          <div
            className="flex flex-col items-center justify-center gap-6 rounded-2xl bg-transparent"
            style={{ padding: '48px 32px', minHeight: '120px' }}
          >
            <p className="text-[15px] font-medium italic text-neutral-900 dark:text-neutral-100 text-center leading-6 transition-opacity duration-300 ease-in-out">
              {typedQuote}
            </p>
          </div>
        ) : null}

        {summary ? (
          <div className="text-sm leading-6 text-neutral-700 dark:text-neutral-300">
            {summary}
          </div>
        ) : null}

        {image ? (
          <div className="rounded-2xl overflow-hidden">
            <img src={image} alt={imageAlt} className="block h-auto w-auto object-cover" />
          </div>
        ) : null}

        <StepsList />
      </section>
    );
  }

  return (
    <section className="flex flex-col gap-6 py-8">
      <div>
        <h3 className="text-lg font-semibold text-neutral-900 dark:text-neutral-100">{title}</h3>
        {subtitle ? <p className="text-sm text-neutral-600 dark:text-neutral-400">{subtitle}</p> : null}
      </div>

      {quotes.length ? (
        <div
          className="flex flex-col items-center justify-center gap-6 rounded-2xl bg-transparent"
          style={{ padding: '48px 32px', minHeight: '120px' }}
        >
          <p className="text-[15px] font-medium italic text-neutral-900 dark:text-neutral-100 text-center leading-6 transition-opacity duration-300 ease-in-out">
            {typedQuote}
          </p>
        </div>
      ) : null}

      {summary ? (
        <div className="text-sm leading-6 text-neutral-700 dark:text-neutral-300">
          {summary}
        </div>
      ) : null}

      {image ? (
        <div className="rounded-2xl border border-black/[0.08] dark:border-neutral-100/[0.08] overflow-hidden">
          <img src={image} alt={imageAlt} className="block h-full w-full object-cover" />
        </div>
      ) : null}

      <StepsList />
    </section>
  );
};

export const UseCase = ({
  title,
  icon,
  image,
  imageAlt = '',
  quotes = [],
  summary,
  steps = [],
}) => {
  const [activeQuoteIndex, setActiveQuoteIndex] = useState(0);
  const [typedQuote, setTypedQuote] = useState('');
  const [isDeleting, setIsDeleting] = useState(false);
  const hasMultipleQuotes = quotes.length > 1;
  const typingTimeoutRef = useRef(null);
  const holdTimeoutRef = useRef(null);
  const charIndexRef = useRef(0);
  const targetRef = useRef('');
  const typingSpeed = 25;
  const deletingSpeed = 15;
  const holdDuration = 1800;
  const pauseAfterDelete = 300;

  const clearTimers = () => {
    if (typingTimeoutRef.current) {
      clearTimeout(typingTimeoutRef.current);
      typingTimeoutRef.current = null;
    }
    if (holdTimeoutRef.current) {
      clearTimeout(holdTimeoutRef.current);
      holdTimeoutRef.current = null;
    }
  };

  useEffect(() => {
    if (!quotes.length) return undefined;

    clearTimers();
    setIsDeleting(false);
    setTypedQuote('');
    charIndexRef.current = 0;
    const currentQuote = quotes[activeQuoteIndex] ?? '';
    targetRef.current = `"${currentQuote}"`;

    const typeNext = () => {
      if (charIndexRef.current < targetRef.current.length) {
        setTypedQuote((prev) => {
          const nextChar = targetRef.current.charAt(charIndexRef.current);
          charIndexRef.current += 1;
          return prev + nextChar;
        });
        typingTimeoutRef.current = setTimeout(typeNext, typingSpeed);
      } else if (hasMultipleQuotes) {
        holdTimeoutRef.current = setTimeout(() => {
          setIsDeleting(true);
          deleteQuote();
        }, holdDuration);
      }
    };

    const deleteQuote = () => {
      setTypedQuote((prev) => {
        if (prev.length > 0) {
          typingTimeoutRef.current = setTimeout(deleteQuote, deletingSpeed);
          return prev.slice(0, -1);
        } else {
          setIsDeleting(false);
          holdTimeoutRef.current = setTimeout(() => {
            setActiveQuoteIndex((prevIdx) => (prevIdx + 1) % quotes.length);
          }, pauseAfterDelete);
          return '';
        }
      });
    };

    typeNext();

    return () => {
      clearTimers();
    };
  }, [activeQuoteIndex, quotes, hasMultipleQuotes, typingSpeed, deletingSpeed, holdDuration, pauseAfterDelete]);

  return (
    <section className="flex flex-col gap-2 py-10">

    <div className="space-y-2">
        <div className="flex items-center gap-2">
          {icon}
          <h3 className="text-base font-semibold tracking-tight text-neutral-900 dark:text-neutral-100">{title}</h3>
        </div>
    
   

  

        {quotes.length ? (
          <div
            className="flex flex-col items-center justify-center gap-6 rounded-2xl bg-transparent"
            style={{ padding: '48px 32px', minHeight: '120px' }}
          >
            <p className="text-[15px] font-medium italic text-neutral-900 dark:text-neutral-100 text-center leading-6 transition-opacity duration-300 ease-in-out">
              {typedQuote}
            </p>
          </div>
        ) : null}

          {summary ? (
          <div className=" pt-4 text-m leading-6 text-neutral-600 dark:text-neutral-400">
            {summary}
          </div>
        ) : null}

<br/>
           <div className="rounded-3xl overflow-hidden w-full">
        <div className="relative w-full" style={{ aspectRatio: '16/9', minHeight: 0 }}>
          <img
            src={image}
            alt={imageAlt}
            className="block w-full h-auto object-contain"
            className="mx-auto"
            style={{ objectPosition: 'top', maxHeight: '400px' }}
          />
        </div>
      </div>

      

        {steps.length ? (
          <div className="space-y-2">

          <br/>

            <p className="text-m font-medium text-neutral-900 dark:text-neutral-100 mt-4">Rover solves this:</p>
            <ol className="list-decimal space-y-2 pl-5 text-m leading-6 text-neutral-700 dark:text-neutral-300">
              {steps.map((step, index) => (
                <li key={`${step}-${index}`}>{step}</li>
              ))}
            </ol>
          </div>
        ) : null}
      </div>
    </section>
  );
};

export const LearnMoreCard = ({ title, icon, href }) => {
  return (
    <a
      href={href}
      className="learn-more-card flex flex-col items-start rounded-lg outline outline-1 outline-offset-[-0.5px] outline-black/[0.08] dark:outline-neutral-100/[0.08] transition-colors duration-200 no-underline"
      style={{ 
        padding: '1rem',
        gap: '16px'
      }}
    >
      <div className="flex items-center">
        <Icon 
          icon={icon}
          style={{ strokeWidth: '0.75px' }}
        />
      </div>
      <span className="text-neutral-900 dark:text-neutral-100 font-medium text-[15px] leading-5">
        {title}
      </span>
    </a>
  );
};

export const LearnMoreCardGroup = ({ children, cols = 3 }) => {
  return (
    <div 
      className="grid mt-6"
      style={{ 
        gridTemplateColumns: `repeat(${cols}, 1fr)`,
        gap: '12px',
        marginTop: '1.5rem',
        marginBottom: '0',
        overflow: 'visible'
      }}
    >
      {children}
    </div>
  );
};

export const DetailPageTabs = () => {
  const [activeTab, setActiveTab] = useState('Transaction');
  
  const tabs = [
    'Transaction',
    'Address (Account)',
    'Address (Smart Contract)',
    'Asset (Token)',
    'Asset (NFT)',
    'Block'
  ];

  return (
    <div className="rounded-xl mt-3 pt-6">
      <div className="flex mb-2 overflow-x-auto">
        {tabs.map((tab) => (
          <button
            key={tab}
            onClick={() => setActiveTab(tab)}
            className={`text-sm font-medium px-2 py-1 whitespace-nowrap transition-all duration-200 ${
              activeTab === tab
                ? 'opacity-100 bg-neutral-200 dark:bg-neutral-800 dark:text-neutral-100'
                : 'opacity-60 bg-transparent hover:opacity-100'
            }`}
            style={{
              borderRadius: activeTab === tab ? '8px' : '0',
            }}
          >
            {tab}
          </button>
        ))}
      </div>
      <div className="text-base">
        <h3 className="font-semibold text-lg mb-4 text-neutral-900 dark:text-neutral-100">
          Subtransactions (aka Internal Transactions)
        </h3>
        <p className="mb-0 text-neutral-700 dark:text-neutral-300">
          <span style={{ fontSize: '15px', lineHeight: '1.7' }} className="sm:text-[15px]">
            There is a unique icon associated with each subtransaction that indicates the level the subtransaction exists at in relation to the root transaction. The syntax (0-1-0) is how you can follow it.
          </span>
        </p>
      </div>
    </div>
  );
};
